"use strict";var pu;!function(t){function e(t,e,i){if(t.addEventListener)t.addEventListener(e,i);else{var n=t;n.attachEvent?n.attachEvent("on"+e,i):n[e]=i}}function i(t,e){var i;return i="object"==typeof t?Object.keys(t).filter(function(t){return"length"!==t}).map(function(e){return t[e]}):t,i.forEach(function(t){t.uploadStatus=e||t.uploadStatus,t.responseCode=t.responseCode||0,t.responseText=t.responseText||"",t.progress=t.progress||0,t.sentBytes=t.sentBytes||0,t.cancel=t.cancel||function(){}}),i}function n(t,e,i){return void 0===i&&(i=!1),t?i?function(){e(),t()}:function(){t(),e()}:e}function o(t,e){var i=Object(t);for(var n in e)!Object.prototype.hasOwnProperty.call(e,n)||void 0!==i[n]&&null!==i[n]||(i[n]=e[n]);return i}function a(t,e){return new d(t,e)}function s(t,e){return new f(t,e)}function l(t){return r(t)?t():t}function r(t){return"function"==typeof t}function c(){var t=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)});return e}function u(){return{fileSizeInvalid:function(t){return"The selected file exceeds the allowed size of "+t+" or its size is 0 MB. Please choose another file."},fileTypeInvalid:function(t){return"File format is not allowed. Only "+(t?t:"")+" files are allowed."},invalidResponseFromServer:function(){return"Invalid response from server"}}}function p(t,e,i){if(t.removeEventListener)t.removeEventListener(e,i);else{var n=t;n.detachEvent?n.detachEvent("on"+e,i):n[e]=null}}t.addEventHandler=e,t.isFileApi=!(!window.File||!window.FormData),t.castFiles=i,t.decorateSimpleFunction=n,t.getUploadCore=a,t.getUploader=s,t.getValueOrResult=l,t.newGuid=c,t.removeEventHandler=p;var h=function(){function n(e,i,n){if(this.targetElement=e,this.options=o(i,this.defaultOptions()),this.uploader=n,this.uploadCore=a(this.options,this.uploader.queue.callbacks),!t.isFileApi)throw"Only browsers with FileAPI supported.";this.setupFileApiElements()}return n.prototype.start=function(t){void 0===t&&(t=!1),this.options.manualStart&&this.fileList&&(this.putFilesToQueue(),t&&this.clear())},n.prototype.clear=function(){this.fileList=null},n.prototype.destroy=function(){this.unregisterOnClick&&this.unregisterOnClick(),this.unregisterOnDrop&&this.unregisterOnDrop(),this.unregisterOnChange&&this.unregisterOnChange(),this.unregisterOnDragOver&&this.unregisterOnDragOver(),this.unregisterOnDragLeave&&this.unregisterOnDragLeave(),this.unregisterOnDragOverGlobal&&this.unregisterOnDragOverGlobal(),this.unregisterOnDragLeaveGlobal&&this.unregisterOnDragLeaveGlobal(),this._fileInput&&document.body.removeChild(this._fileInput)},Object.defineProperty(n.prototype,"fileInput",{get:function(){return this._fileInput},enumerable:!0,configurable:!0}),n.prototype.defaultOptions=function(){return{localizer:u(),maxFileSize:1024,allowDragDrop:!0,clickable:!0,accept:"*.*",validateExtension:!1,multiple:!0,allowEmptyFile:!1}},n.prototype.selectFiles=function(t){var e=this;this.fileList=i(t),this.options.onFileSelected&&this.fileList.forEach(function(t){e.options.onFileSelected&&e.options.onFileSelected(t)}),this.options.manualStart||this.putFilesToQueue()},n.prototype.putFilesToQueue=function(){var t=this;this.fileList&&(this.fileList.forEach(function(e){e.guid=c(),delete e.uploadStatus,e.url=t.uploadCore.getUrl(e),e.onError=t.options.onFileError||function(){},e.onCancel=t.options.onFileCanceled||function(){},t.validateFile(e)?e.start=function(){t.uploadCore.upload([e]),t.options.onFileAdded&&t.options.onFileAdded(e),e.start=function(){}}:e.onError(e)}),this.uploader.queue.addFiles(this.fileList))},n.prototype.validateFile=function(t){return this.isFileSizeValid(t)?!this.isFileTypeInvalid(t)||(t.uploadStatus=v.failed,t.responseText=this.options.localizer.fileTypeInvalid(this.options.accept),!1):(t.uploadStatus=v.failed,t.responseText=this.options.localizer.fileSizeInvalid(this.options.maxFileSize),!1)},n.prototype.setupFileApiElements=function(){var t=this;this._fileInput=document.createElement("input"),this._fileInput.setAttribute("type","file"),this._fileInput.setAttribute("accept",this.options.accept?this.options.accept:""),this._fileInput.style.display="none";var i=function(e){return t.onChange(e)};e(this._fileInput,"change",i),this.unregisterOnChange=function(){t._fileInput&&p(t._fileInput,"change",onchange)},this.options.multiple&&this._fileInput.setAttribute("multiple",""),this.registerEvents(),document.body.appendChild(this._fileInput)},n.prototype.registerEvents=function(){var t=this,i=function(){return t.onClick()};e(this.targetElement,"click",i),this.unregisterOnClick=function(){return p(t.targetElement,"click",i)};var n=function(e){return t.onDrag(e)};e(this.targetElement,"dragover",n),this.unregisterOnDragOver=function(){return p(t.targetElement,"dragover",n)};var o=function(){return t.onDragLeave()};e(this.targetElement,"dragleave",o),this.unregisterOnDragOver=function(){return p(t.targetElement,"dragleave",o)};var a=function(){return t.onDragGlobal()};e(document.body,"dragover",a),this.unregisterOnDragOverGlobal=function(){return p(document.body,"dragover",a)};var s=function(){return t.onDragLeaveGlobal()};e(document.body,"dragleave",s),this.unregisterOnDragOverGlobal=function(){return p(document.body,"dragleave",s)};var l=function(e){return t.onDrop(e)};e(this.targetElement,"drop",l),this.unregisterOnDrop=function(){return p(t.targetElement,"drop",l)}},n.prototype.onChange=function(t){this.selectFiles(t.target.files)},n.prototype.onDrag=function(t){if(l(this.options.allowDragDrop)){this.addDragOverStyle(this.options.dragOverStyle);var e=void 0;if(t.dataTransfer){try{e=t.dataTransfer.effectAllowed}catch(i){}t.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy"}this.stopEventPropagation(t)}},n.prototype.onDragLeave=function(){l(this.options.allowDragDrop)&&this.removeDragOverStyle(this.options.dragOverStyle)},n.prototype.onDragGlobal=function(){l(this.options.allowDragDrop)&&this.addDragOverStyle(this.options.dragOverGlobalStyle)},n.prototype.onDragLeaveGlobal=function(){l(this.options.allowDragDrop)&&this.removeDragOverStyle(this.options.dragOverGlobalStyle)},n.prototype.removeDragOverStyle=function(t){t&&this.targetElement.classList.remove(t)},n.prototype.addDragOverStyle=function(t){t&&this.targetElement.classList.add(t)},n.prototype.onDrop=function(t){if(l(this.options.allowDragDrop)&&(this.stopEventPropagation(t),t.dataTransfer)){this.removeDragOverStyle(this.options.dragOverStyle);var e=t.dataTransfer.files;if(e.length){this.options.multiple||(e=[e[0]]);var i=t.dataTransfer.items;if(i&&i.length&&null!==i[0].webkitGetAsEntry)if(this.options.multiple)this.addFilesFromItems(i);else{var n=[i[0]];this.addFilesFromItems(n)}else this.handleFiles(e)}}},n.prototype.isIeVersion=function(t){return RegExp("msie"+(isNaN(t)?"":"\\s"+t.toString()),"i").test(navigator.userAgent)},n.prototype.onClick=function(){var t=this;l(this.options.clickable)&&this._fileInput&&(this._fileInput.value="",this.isIeVersion(10)?setTimeout(function(){t._fileInput&&t._fileInput.click()},200):this._fileInput.click())},n.prototype.addFilesFromItems=function(t){for(var e,i=0;i<t.length;i++){var n=t[i];n.webkitGetAsEntry&&(e=n.webkitGetAsEntry())?e.isFile?this.selectFiles([n.getAsFile()]):e.isDirectory&&this.processDirectory(e,e.name):n.getAsFile&&(n.kind&&"file"!==n.kind||this.selectFiles([n.getAsFile()]))}},n.prototype.processDirectory=function(t,e){var i=t.createReader(),n=this,o=function(t){for(var i=0;i<t.length;i++){var o=t[i];o.isFile?o.file(function(t){"."!==t.name.substring(0,1)&&(t.fullPath=""+e+"/"+t.name,n.selectFiles([t]))}):o.isDirectory&&n.processDirectory(o,""+e+"/"+o.name)}};i.readEntries(o,function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(t):void 0})},n.prototype.handleFiles=function(t){for(var e=0;e<t.length;e++)this.selectFiles([t[e]])},n.prototype.isFileSizeValid=function(t){var e=1024*this.options.maxFileSize*1024;return!(t.size>e||!this.options.allowEmptyFile&&0===t.size)},n.prototype.isFileTypeInvalid=function(t){if(t.name&&this.options.accept&&("*"!==this.options.accept.trim()||"*.*"!==this.options.accept.trim())&&this.options.validateExtension&&this.options.accept.indexOf("/")===-1){var e=this.options.accept.split(","),i=t.name.substring(t.name.lastIndexOf("."),t.name.length);if(i.indexOf(".")===-1)return!0;for(var n=!0,o=0;o<e.length;o++)e[o].toUpperCase().trim()===i.toUpperCase()&&(n=!1);return n}return!1},n.prototype.stopEventPropagation=function(t){t.stopPropagation(),t.preventDefault?t.preventDefault():t.returnValue=!1},n}();t.UploadArea=h;var d=function(){function e(t,e){void 0===e&&(e={}),this.callbacks=e,this.options=o(t,this.getDefaultOptions()),this.setFullCallbacks(e)}return e.prototype.upload=function(e){var n=this;if(t.isFileApi){var o=i(e,v.uploading);o.forEach(function(t){return n.processFile(t)})}},e.prototype.getUrl=function(t){return"function"==typeof this.options.url?this.options.url(t):this.options.url},e.prototype.processFile=function(t){var e=this.createRequest(t);this.setCallbacks(e,t),this.send(e,t)},e.prototype.createRequest=function(t){var e=new XMLHttpRequest,i=t.url||this.getUrl(t);return e.open(this.options.method,i,!0),e.withCredentials=!!this.options.withCredentials,this.setHeaders(e),e},e.prototype.setHeaders=function(t){var e=this;this.options.headers&&(this.options.headers.Accept||t.setRequestHeader("Accept","application/json"),this.options.headers["Cache-Control"]||t.setRequestHeader("Cache-Control","no-cache"),this.options.headers["X-Requested-With"]||t.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(this.options.headers).forEach(function(i){if(e.options.headers){var n=e.options.headers[i];void 0!==n&&null!==n&&t.setRequestHeader(i,(n||"").toString())}}))},e.prototype.setCallbacks=function(t,e){var i=this;e.cancel=n(e.cancel,function(){t.abort(),e.uploadStatus=v.canceled,e.onCancel&&e.onCancel(e),i.callbacks.onCancelledCallback&&i.callbacks.onCancelledCallback(e),i.callbacks.onFileStateChangedCallback&&i.callbacks.onFileStateChangedCallback(e),i.callbacks.onFinishedCallback&&i.callbacks.onFinishedCallback(e)},!0),t.onload=function(){return i.onload(e,t)},t.onerror=function(){return i.handleError(e,t)},t.upload.onprogress=function(t){return i.updateProgress(e,t)}},e.prototype.send=function(t,e){var i=this.createFormData(e);this.callbacks.onUploadStartedCallback&&this.callbacks.onUploadStartedCallback(e),this.callbacks.onFileStateChangedCallback&&this.callbacks.onFileStateChangedCallback(e),t.send(i)},e.prototype.createFormData=function(t){var e=this,i=new FormData;return this.options.params&&Object.keys(this.options.params).forEach(function(t){if(e.options.params){var n=e.options.params[t];void 0!==n&&null!==n&&i.append(t,e.castParamType(n))}}),i.append("file",t,t.name),i},e.prototype.castParamType=function(t){return this.isBoolean(t)||this.isNumber(t)?t.toString():t},e.prototype.isNumber=function(t){return"number"==typeof t},e.prototype.isBoolean=function(t){return"number"==typeof t},e.prototype.handleError=function(t,e){t.uploadStatus=v.failed,this.setResponse(t,e),t.onError&&t.onError(t),this.callbacks.onErrorCallback&&this.callbacks.onErrorCallback(t),this.callbacks.onFileStateChangedCallback&&this.callbacks.onFileStateChangedCallback(t),this.callbacks.onFinishedCallback&&this.callbacks.onFinishedCallback(t)},e.prototype.updateProgress=function(t,e){e?e.lengthComputable?(t.progress=Math.round(100*(e.loaded/e.total)),t.sentBytes=e.loaded):(t.progress=0,t.sentBytes=0):(t.progress=100,t.sentBytes=t.size),this.callbacks.onProgressCallback&&this.callbacks.onProgressCallback(t)},e.prototype.onload=function(t,e){4===e.readyState&&(100!==t.progress&&this.updateProgress(t),200===e.status?this.finished(t,e):this.handleError(t,e))},e.prototype.finished=function(t,e){t.uploadStatus=v.uploaded,this.setResponse(t,e),this.callbacks.onUploadedCallback&&this.callbacks.onUploadedCallback(t),this.callbacks.onFileStateChangedCallback&&this.callbacks.onFileStateChangedCallback(t),this.callbacks.onFinishedCallback&&this.callbacks.onFinishedCallback(t)},e.prototype.setResponse=function(t,e){t.responseCode=e.status,t.responseText=e.responseText||e.statusText||(e.status?e.status.toString():this.options.localizer.invalidResponseFromServer())},e.prototype.getDefaultOptions=function(){return{headers:{},params:{},withCredentials:!1,localizer:u()}},e.prototype.setFullCallbacks=function(t){this.callbacks.onProgressCallback=t.onProgressCallback||function(){},this.callbacks.onCancelledCallback=t.onCancelledCallback||function(){},this.callbacks.onFinishedCallback=t.onFinishedCallback||function(){},this.callbacks.onUploadedCallback=t.onUploadedCallback||function(){},this.callbacks.onErrorCallback=t.onErrorCallback||function(){},this.callbacks.onUploadStartedCallback=t.onUploadStartedCallback||function(){},this.callbacks.onFileStateChangedCallback=t.onFileStateChangedCallback||function(){}},e}();t.UploadCore=d;var f=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e={}),this.options=t,this.uploadAreas=[],this.queue=new g(t,e)}return t.prototype.registerArea=function(t,e){var i=new h(t,e,this);return this.uploadAreas.push(i),i},t.prototype.unregisterArea=function(t){var e=this.uploadAreas.indexOf(t);e>=0&&(this.uploadAreas[e].destroy(),this.uploadAreas.splice(e,1))},Object.defineProperty(t.prototype,"firstUploadArea",{get:function(){return this.uploadAreas[0]},enumerable:!0,configurable:!0}),t}();t.Uploader=f;var g=function(){function e(t,e){this.offset={fileCount:0,running:!1},this.queuedFiles=[],this.options=t,this.callbacks=e,this.setFullOptions(),this.setFullCallbacks()}return e.prototype.addFiles=function(t){var e=this;t.forEach(function(t){e.queuedFiles.some(function(e){return e===t||!!e.guid&&e.guid===t.guid})||(e.queuedFiles.push(t),t.remove=n(t.remove,function(){e.removeFile(t)})),e.callbacks.onFileAddedCallback&&e.callbacks.onFileAddedCallback(t),t.uploadStatus===v.failed?e.callbacks.onErrorCallback&&e.callbacks.onErrorCallback(t):t.uploadStatus=v.queued}),this.filesChanged()},e.prototype.removeFile=function(t,e){void 0===e&&(e=!1);var i=this.queuedFiles.indexOf(t);i<0||(this.deactivateFile(t),this.queuedFiles.splice(i,1),this.callbacks.onFileRemovedCallback&&this.callbacks.onFileRemovedCallback(t),e||this.filesChanged())},e.prototype.clearFiles=function(t,e){var i=this;void 0===t&&(t=[]),void 0===e&&(e=!1),e||(t=t.concat([v.queued,v.uploading])),this.queuedFiles.filter(function(e){return t.indexOf(e.uploadStatus)<0}).forEach(function(t){return i.removeFile(t,!0)}),this.callbacks.onQueueChangedCallback&&this.callbacks.onQueueChangedCallback(this.queuedFiles)},e.prototype.filesChanged=function(){this.options.autoRemove&&this.removeFinishedFiles(),this.options.autoStart&&this.startWaitingFiles(),this.callbacks.onQueueChangedCallback&&this.callbacks.onQueueChangedCallback(this.queuedFiles),this.checkAllFinished()},e.prototype.checkAllFinished=function(){var t=this.queuedFiles.filter(function(t){return[v.queued,v.uploading].indexOf(t.uploadStatus)>=0});0===t.length&&this.callbacks.onAllFinishedCallback&&this.callbacks.onAllFinishedCallback()},e.prototype.setFullOptions=function(){this.options.maxParallelUploads=this.options.maxParallelUploads||0,this.options.parallelBatchOffset=this.options.parallelBatchOffset||0,this.options.autoStart=t.isFileApi&&(this.options.autoStart||!1),this.options.autoRemove=this.options.autoRemove||!1},e.prototype.setFullCallbacks=function(){var t=this;this.callbacks.onFileAddedCallback=this.callbacks.onFileAddedCallback||function(){},this.callbacks.onFileRemovedCallback=this.callbacks.onFileRemovedCallback||function(){},this.callbacks.onAllFinishedCallback=this.callbacks.onAllFinishedCallback||function(){},this.callbacks.onQueueChangedCallback=this.callbacks.onQueueChangedCallback||function(){},this.callbacks.onFileStateChangedCallback=function(){return t.filesChanged()}},e.prototype.startWaitingFiles=function(){this.getWaitingFiles().forEach(function(t){return t.start()})},e.prototype.removeFinishedFiles=function(){var t=this;this.queuedFiles.filter(function(t){return[v.uploaded,v.canceled].indexOf(t.uploadStatus)>=0}).forEach(function(e){return t.removeFile(e,!0)})},e.prototype.deactivateFile=function(t){t.uploadStatus===v.uploading&&t.cancel(),t.uploadStatus=v.removed,t.cancel=function(){},t.remove=function(){},t.start=function(){}},e.prototype.getWaitingFiles=function(){if(!this.options.autoStart)return[];var t=this.queuedFiles.filter(function(t){return t.uploadStatus===v.queued});if(this.options.maxParallelUploads){var e=this.queuedFiles.filter(function(t){return t.uploadStatus===v.uploading}).length,i=Math.min(t.length,this.options.maxParallelUploads-e);if(i<=0)return[];this.options.parallelBatchOffset&&(this.offset.running||this.startOffset(),i=Math.min(this.offset.fileCount+i,this.options.maxParallelUploads)-this.offset.fileCount,this.offset.fileCount+=i),t=t.slice(0,i)}return t},e.prototype.startOffset=function(){var t=this;this.offset.fileCount=0,this.offset.running=!0,setTimeout(function(){t.offset.fileCount=0,t.offset.running=!1,t.filesChanged()},this.options.parallelBatchOffset)},e}();t.UploadQueue=g;var v;!function(t){t[t.queued=0]="queued",t[t.uploading=1]="uploading",t[t.uploaded=2]="uploaded",t[t.failed=3]="failed",t[t.canceled=4]="canceled",t[t.removed=5]="removed"}(v=t.UploadStatus||(t.UploadStatus={}))}(pu||(pu={}));