"use strict";var pu;!function(i){function l(t,e,o,i){t.addEventListener?t.addEventListener(e,o,i):(t=t).attachEvent?t.attachEvent("on"+e,o):t[e]=o}var o;function n(e,o){var t="object"==typeof e?Object.keys(e).filter(function(t){return"length"!==t}).map(function(t){return e[t]}):e;return t.forEach(function(t){t.uploadStatus=o||t.uploadStatus,t.responseCode=t.responseCode||0,t.responseText=t.responseText||"",t.errorCode=t.errorCode,t.progress=t.progress||0,t.sentBytes=t.sentBytes||0,t.cancel=t.cancel||function(){}}),t}function s(t,e,o){return void 0===o&&(o=!1),t?o?function(){e(),t()}:function(){t(),e()}:e}function a(t,e){var o,i=Object(t);for(o in e)!Object.prototype.hasOwnProperty.call(e,o)||void 0!==i[o]&&null!==i[o]||(i[o]=e[o]);return i}function r(t,e){return new g(t,e)}function c(t){return"function"==typeof t?t():t}function u(){var o=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"===t?e:3&e|8).toString(16)})}function t(){return{fileSizeInvalid:function(t){return"The selected file exceeds the allowed size of "+t+" or its size is 0 MB. Please choose another file."},fileTypeInvalid:function(t){return"File format is not allowed. Only "+(t||"")+" files are allowed."},invalidResponseFromServer:function(){return"Invalid response from server"}}}i.addEventHandler=l,(C=o=i.ErrorCode||(i.ErrorCode={}))[C.NoError=0]="NoError",C[C.FileSizeExceeded=1]="FileSizeExceeded",C[C.UnsupportedFileFormat=2]="UnsupportedFileFormat",C[C.XhrResponseError=3]="XhrResponseError",i.isFileApi=!(!window.File||!window.FormData),i.castFiles=n,i.decorateSimpleFunction=s,i.getUploadCore=r,i.getUploader=function(t,e){return new v(t,e)},i.getValueOrResult=c,i.newGuid=u;var p=(h.processItems=function(t,e){var o=new h;o.processItems(t,function(){return e&&e(o.files)})},h.prototype.processItems=function(t,e){var o=this;e=this.callbackAfter(t.length,e),this.toValidItems(t).forEach(function(t){return o.processEntry(t.webkitGetAsEntry(),"",e)})},h.prototype.processEntries=function(t,e,o){var i=this;void 0===e&&(e=""),o=this.callbackAfter(t.length,o),t.forEach(function(t){return i.processEntry(t,e,o)})},h.prototype.processEntry=function(t,e,o){void 0===e&&(e=""),this.isFileSystemDirectoryEntry(t)?this.processDirectoryEntry(t,e,o):this.isFileSystemFileEntry(t)?this.processFileEntry(t,e,o):void 0!==o&&o()},h.prototype.processDirectoryEntry=function(e,o,i){var n=this;void 0===o&&(o=""),e.createReader().readEntries(function(t){return n.processEntries(t,o+"/"+e.name,i)},this.pushAndCallback(this.errors,i))},h.prototype.processFileEntry=function(t,e,o){var i=this;void 0===e&&(e=""),t.file(function(t){return i.processFile(t,e,o)},this.pushAndCallback(this.errors,o))},h.prototype.processFile=function(t,e,o){void 0===e&&(e=""),t.fullPath=e+"/"+t.name,this.pushAndCallback(this.files,o)(t)},h.prototype.callbackAfter=function(t,e){return function(){return 0==--t&&void 0!==e?e():t}},h.prototype.pushAndCallback=function(e,o){return function(t){e.push(t),void 0!==o&&o()}},h.prototype.toValidItems=function(t){for(var e=[],o=0;o<t.length;++o)void 0!==t[o].webkitGetAsEntry&&null!==t[o].webkitGetAsEntry&&e.push(t[o]);return e},h.prototype.isFileSystemFileEntry=function(t){return t.isFile},h.prototype.isFileSystemDirectoryEntry=function(t){return t.isDirectory},h);function h(){this.errors=[],this.files=[]}function d(t,e,o){t.removeEventListener?t.removeEventListener(e,o):(t=t).detachEvent?t.detachEvent("on"+e,o):t[e]=null}i.ItemProcessor=p,i.removeEventHandler=d;var f=(e.prototype.start=function(t,e){void 0===t&&(t=!1),this.options.manualStart&&(e||this.fileList)&&(this.putFilesToQueue(e),t&&this.clear(e))},e.prototype.clear=function(e){this.fileList=this.fileList&&e?this.fileList.filter(function(t){return e.indexOf(t)<0}):null},e.prototype.destroy=function(){this.unregisterOnClick&&this.unregisterOnClick(),this.unregisterOnDrop&&this.unregisterOnDrop(),this.unregisterOnChange&&this.unregisterOnChange(),this.unregisterOnDragOver&&this.unregisterOnDragOver(),this.unregisterOnDragLeave&&this.unregisterOnDragLeave(),this.unregisterOnDragOverGlobal&&this.unregisterOnDragOverGlobal(),this.unregisterOnDragLeaveGlobal&&this.unregisterOnDragLeaveGlobal(),this._fileInput&&document.body.removeChild(this._fileInput)},Object.defineProperty(e.prototype,"fileInput",{get:function(){return this._fileInput},enumerable:!1,configurable:!0}),e.prototype.defaultOptions=function(){return{localizer:t(),maxFileSize:1024,allowDragDrop:!0,clickable:!0,accept:"*.*",validateExtension:!1,multiple:!0,allowEmptyFile:!1,useCapture:!1}},e.prototype.selectFiles=function(t){var e,o=this;this.fileList=n(t),this.options.onFileSelected&&this.fileList.forEach(function(t){o.options.onFileSelected&&o.options.onFileSelected(t)}),this.options.onFilesSelected&&(e=[],this.fileList.forEach(function(t){e.push(t)}),this.options.onFilesSelected(e)),this.options.manualStart||this.putFilesToQueue()},e.prototype.putFilesToQueue=function(e){var o=this;(e=this.fileList&&e?this.fileList.filter(function(t){return e&&0<=e.indexOf(t)}):this.fileList||void 0)&&(e.forEach(function(t){t.guid=u(),delete t.uploadStatus,t.url=o.uploadCore.getUrl(t),t.onError=o.options.onFileError||function(){},t.onCancel=o.options.onFileCanceled||function(){},o.validateFile(t)?t.start=function(){o.uploadCore.upload([t]),o.options.onFileAdded&&o.options.onFileAdded(t),t.start=function(){}}:t.onError(t)}),this.uploader.queue.addFiles(e))},e.prototype.validateFile=function(t){return this.isFileSizeValid(t)?this.isFileTypeInvalid(t)?(t.uploadStatus=y.failed,t.responseText=this.options.localizer.fileTypeInvalid(this.options.accept),t.errorCode=o.UnsupportedFileFormat,!1):(t.errorCode=o.NoError,!0):(t.uploadStatus=y.failed,t.responseText=this.options.localizer.fileSizeInvalid(this.options.maxFileSize),t.errorCode=o.FileSizeExceeded,!1)},e.prototype.setupFileApiElements=function(){var e=this;this._fileInput=document.createElement("input"),this._fileInput.setAttribute("type","file"),this._fileInput.setAttribute("accept",this.options.accept||""),this._fileInput.style.display="none";l(this._fileInput,"change",function(t){return e.onChange(t)},this.options.useCapture),this.unregisterOnChange=function(){e._fileInput&&d(e._fileInput,"change",onchange)},this.options.multiple&&this._fileInput.setAttribute("multiple",""),this.registerEvents(),document.body.appendChild(this._fileInput)},e.prototype.registerEvents=function(){function t(){return e.onClick()}var e=this,o=this.options.useCapture;l(this.targetElement,"click",t,o),this.unregisterOnClick=function(){return d(e.targetElement,"click",t)};function i(t){return e.onDrag(t)}l(this.targetElement,"dragover",i,o),this.unregisterOnDragOver=function(){return d(e.targetElement,"dragover",i)};function n(){return e.onDragLeave()}l(this.targetElement,"dragleave",n,o),this.unregisterOnDragOver=function(){return d(e.targetElement,"dragleave",n)};function s(){return e.onDragGlobal()}l(document.body,"dragover",s,o),this.unregisterOnDragOverGlobal=function(){return d(document.body,"dragover",s)};function a(){return e.onDragLeaveGlobal()}l(document.body,"dragleave",a,o),this.unregisterOnDragOverGlobal=function(){return d(document.body,"dragleave",a)};function r(t){return e.onDrop(t)}l(this.targetElement,"drop",r,o),this.unregisterOnDrop=function(){return d(e.targetElement,"drop",r)}},e.prototype.onChange=function(t){this.selectFiles(t.target.files)},e.prototype.onDrag=function(t){if(c(this.options.allowDragDrop)){this.options.onDragEnter&&this.options.onDragEnter(),this.addDragOverStyle(this.options.dragOverStyle);var e=void 0;if(t.dataTransfer){try{e=t.dataTransfer.effectAllowed}catch(t){}t.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy"}this.stopEventPropagation(t)}},e.prototype.onDragLeave=function(){c(this.options.allowDragDrop)&&(this.options.onDragLeave&&this.options.onDragLeave(),this.removeDragOverStyle(this.options.dragOverStyle))},e.prototype.onDragGlobal=function(){c(this.options.allowDragDrop)&&(this.options.onDragGlobalEnter&&this.options.onDragGlobalEnter(),this.addDragOverStyle(this.options.dragOverGlobalStyle))},e.prototype.onDragLeaveGlobal=function(){c(this.options.allowDragDrop)&&(this.options.onDragGlobalLeave&&this.options.onDragGlobalLeave(),this.removeDragOverStyle(this.options.dragOverGlobalStyle))},e.prototype.removeDragOverStyle=function(t){t&&this.targetElement.classList.remove(t)},e.prototype.addDragOverStyle=function(t){t&&this.targetElement.classList.add(t)},e.prototype.onDrop=function(t){var e,o=this;c(this.options.allowDragDrop)&&(this.stopEventPropagation(t),t.dataTransfer&&(this.removeDragOverStyle(this.options.dragOverStyle),(e=t.dataTransfer.files).length&&(this.options.multiple||(e=[e[0]]),(t=t.dataTransfer.items)&&t.length&&null!==t[0].webkitGetAsEntry?(t=this.options.multiple?t:[t[0]],p.processItems(t,function(t){return o.selectFiles(t)})):this.selectFiles(e))))},e.prototype.isIeVersion=function(t){return RegExp("msie"+(isNaN(t)?"":"\\s"+t.toString()),"i").test(navigator.userAgent)},e.prototype.onClick=function(){var t=this;c(this.options.clickable)&&this._fileInput&&(this._fileInput.value="",this.isIeVersion(10)?setTimeout(function(){t._fileInput&&t._fileInput.click()},200):this._fileInput.click())},e.prototype.isFileSizeValid=function(t){var e=1024*this.options.maxFileSize*1024;return!(t.size>e||!this.options.allowEmptyFile&&0===t.size)},e.prototype.isFileTypeInvalid=function(t){if(t.name&&this.options.accept&&("*"!==this.options.accept.trim()||"*.*"!==this.options.accept.trim())&&this.options.validateExtension&&-1===this.options.accept.indexOf("/")){var e=this.options.accept.split(","),o=t.name.substring(t.name.lastIndexOf("."),t.name.length);if(-1===o.indexOf("."))return!0;for(var i=!0,n=0;n<e.length;n++)e[n].toUpperCase().trim()===o.toUpperCase()&&(i=!1);return i}return!1},e.prototype.stopEventPropagation=function(t){t.stopPropagation(),t.preventDefault?t.preventDefault():t.returnValue=!1},e);function e(t,e,o){if(this.targetElement=t,this.options=a(e,this.defaultOptions()),this.uploader=o,this.uploadCore=r(this.options,this.uploader.queue.callbacks),!i.isFileApi)throw"Only browsers with FileAPI supported.";this.setupFileApiElements()}i.UploadArea=f;var g=(b.prototype.upload=function(t){var e=this;i.isFileApi&&n(t,y.uploading).forEach(function(t){return e.processFile(t)})},b.prototype.getUrl=function(t){return"function"==typeof this.options.url?this.options.url(t):this.options.url},b.prototype.processFile=function(t){var e=this.createRequest(t);this.setCallbacks(e,t),this.send(e,t)},b.prototype.createRequest=function(t){var e=new XMLHttpRequest,t=t.url||this.getUrl(t);return e.open(this.options.method,t,!0),e.withCredentials=!!this.options.withCredentials,this.setHeaders(e),e},b.prototype.setHeaders=function(o){var i=this;this.options.headers&&(this.options.headers.Accept||o.setRequestHeader("Accept","application/json"),this.options.headers["Cache-Control"]||o.setRequestHeader("Cache-Control","no-cache"),this.options.headers["X-Requested-With"]||o.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(this.options.headers).forEach(function(t){var e;!i.options.headers||null!=(e=i.options.headers[t])&&o.setRequestHeader(t,(e||"").toString())}))},b.prototype.setCallbacks=function(t,e){var o=this;e.cancel=s(e.cancel,function(){t.abort(),e.uploadStatus=y.canceled,e.onCancel&&e.onCancel(e),o.callbacks.onCancelledCallback&&o.callbacks.onCancelledCallback(e),o.callbacks.onFileStateChangedCallback&&o.callbacks.onFileStateChangedCallback(e),o.callbacks.onFinishedCallback&&o.callbacks.onFinishedCallback(e)},!0),t.onload=function(){return o.onload(e,t)},t.onerror=function(){return o.handleError(e,t)},t.upload.onprogress=function(t){return o.updateProgress(e,t)}},b.prototype.send=function(t,e){var o=this.createFormData(e);this.callbacks.onUploadStartedCallback&&this.callbacks.onUploadStartedCallback(e),this.callbacks.onFileStateChangedCallback&&this.callbacks.onFileStateChangedCallback(e),t.send(o)},b.prototype.createFormData=function(t){var o=this,i=new FormData;return this.options.params&&Object.keys(this.options.params).forEach(function(t){var e;!o.options.params||null!=(e=o.options.params[t])&&i.append(t,o.castParamType(e))}),i.append("file",t,t.name),i},b.prototype.castParamType=function(t){return this.isBoolean(t)||this.isNumber(t)?t.toString():t},b.prototype.isNumber=function(t){return"number"==typeof t},b.prototype.isBoolean=function(t){return"number"==typeof t},b.prototype.handleError=function(t,e){t.responseCode=o.XhrResponseError,t.uploadStatus=y.failed,this.setResponse(t,e),t.onError&&t.onError(t),this.callbacks.onErrorCallback&&this.callbacks.onErrorCallback(t),this.callbacks.onFileStateChangedCallback&&this.callbacks.onFileStateChangedCallback(t),this.callbacks.onFinishedCallback&&this.callbacks.onFinishedCallback(t)},b.prototype.updateProgress=function(t,e){e?e.lengthComputable?(t.progress=Math.round(e.loaded/e.total*100),t.sentBytes=e.loaded):(t.progress=0,t.sentBytes=0):(t.progress=100,t.sentBytes=t.size),this.callbacks.onProgressCallback&&this.callbacks.onProgressCallback(t)},b.prototype.onload=function(t,e){4===e.readyState&&(100!==t.progress&&this.updateProgress(t),200===e.status?this.finished(t,e):this.handleError(t,e))},b.prototype.finished=function(t,e){t.uploadStatus=y.uploaded,this.setResponse(t,e),this.callbacks.onUploadedCallback&&this.callbacks.onUploadedCallback(t),this.callbacks.onFileStateChangedCallback&&this.callbacks.onFileStateChangedCallback(t),this.callbacks.onFinishedCallback&&this.callbacks.onFinishedCallback(t)},b.prototype.setResponse=function(t,e){t.responseCode=e.status,t.responseText=e.responseText||e.statusText||(e.status?e.status.toString():this.options.localizer.invalidResponseFromServer())},b.prototype.getDefaultOptions=function(){return{headers:{},params:{},withCredentials:!1,localizer:t()}},b.prototype.setFullCallbacks=function(t){this.callbacks.onProgressCallback=t.onProgressCallback||function(){},this.callbacks.onCancelledCallback=t.onCancelledCallback||function(){},this.callbacks.onFinishedCallback=t.onFinishedCallback||function(){},this.callbacks.onUploadedCallback=t.onUploadedCallback||function(){},this.callbacks.onErrorCallback=t.onErrorCallback||function(){},this.callbacks.onUploadStartedCallback=t.onUploadStartedCallback||function(){},this.callbacks.onFileStateChangedCallback=t.onFileStateChangedCallback||function(){}},b);function b(t,e){void 0===e&&(e={}),this.callbacks=e,this.options=a(t,this.getDefaultOptions()),this.setFullCallbacks(e)}i.UploadCore=g;var v=(k.prototype.registerArea=function(t,e){e=new f(t,e,this);return this.uploadAreas.push(e),e},k.prototype.unregisterArea=function(t){t=this.uploadAreas.indexOf(t);0<=t&&(this.uploadAreas[t].destroy(),this.uploadAreas.splice(t,1))},Object.defineProperty(k.prototype,"firstUploadArea",{get:function(){return this.uploadAreas[0]},enumerable:!1,configurable:!0}),k);function k(t,e){void 0===t&&(t={}),void 0===e&&(e={}),this.options=t,this.uploadAreas=[],this.queue=new F(t,e)}i.Uploader=v;var y,C,F=(m.prototype.addFiles=function(t){var o=this;t.forEach(function(e){o.queuedFiles.some(function(t){return t===e||!!t.guid&&t.guid===e.guid})||(o.queuedFiles.push(e),e.remove=s(e.remove,function(){o.removeFile(e)})),o.callbacks.onFileAddedCallback&&o.callbacks.onFileAddedCallback(e),e.uploadStatus===y.failed?o.callbacks.onErrorCallback&&o.callbacks.onErrorCallback(e):e.uploadStatus=y.queued}),this.filesChanged()},m.prototype.removeFile=function(t,e){void 0===e&&(e=!1);var o=this.queuedFiles.indexOf(t);o<0||(this.deactivateFile(t),this.queuedFiles.splice(o,1),this.callbacks.onFileRemovedCallback&&this.callbacks.onFileRemovedCallback(t),e||this.filesChanged())},m.prototype.clearFiles=function(e,t){var o=this;void 0===e&&(e=[]),void 0===t&&(t=!1),t||(e=e.concat([y.queued,y.uploading])),this.queuedFiles.filter(function(t){return e.indexOf(t.uploadStatus)<0}).forEach(function(t){return o.removeFile(t,!0)}),this.callbacks.onQueueChangedCallback&&this.callbacks.onQueueChangedCallback(this.queuedFiles)},m.prototype.filesChanged=function(){this.options.autoRemove&&this.removeFinishedFiles(),this.options.autoStart&&this.startWaitingFiles(),this.callbacks.onQueueChangedCallback&&this.callbacks.onQueueChangedCallback(this.queuedFiles),this.checkAllFinished()},m.prototype.checkAllFinished=function(){0===this.queuedFiles.filter(function(t){return 0<=[y.queued,y.uploading].indexOf(t.uploadStatus)}).length&&this.callbacks.onAllFinishedCallback&&this.callbacks.onAllFinishedCallback()},m.prototype.setFullOptions=function(){this.options.maxParallelUploads=this.options.maxParallelUploads||0,this.options.parallelBatchOffset=this.options.parallelBatchOffset||0,this.options.autoStart=i.isFileApi&&(this.options.autoStart||!1),this.options.autoRemove=this.options.autoRemove||!1},m.prototype.setFullCallbacks=function(){var t=this;this.callbacks.onFileAddedCallback=this.callbacks.onFileAddedCallback||function(){},this.callbacks.onFileRemovedCallback=this.callbacks.onFileRemovedCallback||function(){},this.callbacks.onAllFinishedCallback=this.callbacks.onAllFinishedCallback||function(){},this.callbacks.onQueueChangedCallback=this.callbacks.onQueueChangedCallback||function(){},this.callbacks.onFileStateChangedCallback=function(){return t.filesChanged()}},m.prototype.startWaitingFiles=function(){this.getWaitingFiles().forEach(function(t){return t.start()})},m.prototype.removeFinishedFiles=function(){var e=this;this.queuedFiles.filter(function(t){return 0<=[y.uploaded,y.canceled].indexOf(t.uploadStatus)}).forEach(function(t){return e.removeFile(t,!0)})},m.prototype.deactivateFile=function(t){t.uploadStatus===y.uploading&&t.cancel(),t.uploadStatus=y.removed,t.cancel=function(){},t.remove=function(){},t.start=function(){}},m.prototype.getWaitingFiles=function(){if(!this.options.autoStart)return[];var t=this.queuedFiles.filter(function(t){return t.uploadStatus===y.queued});if(this.options.maxParallelUploads){var e=this.queuedFiles.filter(function(t){return t.uploadStatus===y.uploading}).length,e=Math.min(t.length,this.options.maxParallelUploads-e);if(e<=0)return[];this.options.parallelBatchOffset&&(this.offset.running||this.startOffset(),e=Math.min(this.offset.fileCount+e,this.options.maxParallelUploads)-this.offset.fileCount,this.offset.fileCount+=e),t=t.slice(0,e)}return t},m.prototype.startOffset=function(){var t=this;this.offset.fileCount=0,this.offset.running=!0,setTimeout(function(){t.offset.fileCount=0,t.offset.running=!1,t.filesChanged()},this.options.parallelBatchOffset)},m);function m(t,e){this.offset={fileCount:0,running:!1},this.queuedFiles=[],this.options=t,this.callbacks=e,this.setFullOptions(),this.setFullCallbacks()}i.UploadQueue=F,(C=y=i.UploadStatus||(i.UploadStatus={}))[C.queued=0]="queued",C[C.uploading=1]="uploading",C[C.uploaded=2]="uploaded",C[C.failed=3]="failed",C[C.canceled=4]="canceled",C[C.removed=5]="removed"}(pu=pu||{});